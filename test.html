<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Start Interview ‚Äî RecruitAI</title>
<link href="https://fonts.googleapis.com/css2?family=Syne:wght@600;700;800&family=Inter:wght@300;400;500;600&display=swap" rel="stylesheet">
<style>
:root{--bg:#0a0a0f;--s:#13131a;--s2:#1c1c28;--border:#2a2a3d;--accent:#6c63ff;--accent2:#a78bfa;--green:#10b981;--red:#f43f5e;--text:#e2e8f0;--muted:#64748b;}
*{margin:0;padding:0;box-sizing:border-box;}
body{font-family:'Inter',sans-serif;background:var(--bg);color:var(--text);min-height:100vh;}
.topbar{background:var(--s);border-bottom:1px solid var(--border);padding:0 32px;height:60px;display:flex;align-items:center;justify-content:space-between;}
.brand{font-family:'Syne',sans-serif;font-size:18px;font-weight:800;background:linear-gradient(135deg,#fff,var(--accent2));background-clip:text;-webkit-background-clip:text;-webkit-text-fill-color:transparent;}
.topbar-right{display:flex;align-items:center;gap:16px;font-size:13px;color:var(--muted);}
.logout-link{padding:7px 16px;border:1px solid var(--border);border-radius:7px;color:var(--text);cursor:pointer;font-size:13px;text-decoration:none;transition:all .2s;}
.logout-link:hover{border-color:var(--accent);color:var(--accent2);}
.main{max-width:820px;margin:0 auto;padding:48px 20px;}
.greeting h1{font-family:'Syne',sans-serif;font-size:34px;font-weight:800;margin-bottom:8px;background:linear-gradient(135deg,#fff 40%,var(--accent2));background-clip:text;-webkit-background-clip:text;-webkit-text-fill-color:transparent;}
.greeting p{color:var(--muted);font-size:15px;margin-bottom:36px;}
.room-shortcut{background:var(--s);border:1px solid var(--border);border-radius:16px;padding:24px;margin-bottom:28px;display:flex;align-items:flex-end;gap:14px;}
.rs-field{flex:1;}
.rs-field label{display:block;font-size:11px;color:var(--muted);text-transform:uppercase;font-weight:600;letter-spacing:.05em;margin-bottom:8px;}
.rs-field input{width:100%;padding:12px 14px;background:var(--s2);border:1px solid var(--border);border-radius:9px;color:var(--text);font-size:16px;font-family:monospace;letter-spacing:.1em;text-transform:uppercase;outline:none;}
.rs-field input:focus{border-color:var(--accent);}
.btn-join-room{padding:13px 26px;background:linear-gradient(135deg,var(--accent),#8b5cf6);border:none;border-radius:9px;color:#fff;font-size:14px;font-weight:700;cursor:pointer;font-family:'Inter',sans-serif;transition:all .25s;white-space:nowrap;}
.btn-join-room:hover{transform:translateY(-1px);box-shadow:0 8px 20px rgba(108,99,255,.35);}
.divider{display:flex;align-items:center;gap:14px;margin-bottom:24px;color:var(--muted);font-size:13px;}
.divider::before,.divider::after{content:'';flex:1;height:1px;background:var(--border);}
.section-title{font-family:'Syne',sans-serif;font-size:17px;font-weight:700;margin-bottom:14px;}
.mode-grid{display:grid;grid-template-columns:repeat(3,1fr);gap:14px;margin-bottom:22px;}
.mcard{background:var(--s);border:2px solid var(--border);border-radius:14px;padding:22px;cursor:pointer;transition:all .22s;text-align:center;}
.mcard:hover,.mcard.sel{border-color:var(--accent);background:rgba(108,99,255,.08);}
.mcard.sel{box-shadow:0 0 0 4px rgba(108,99,255,.1);}
.mcard-icon{font-size:36px;margin-bottom:10px;}
.mcard-title{font-family:'Syne',sans-serif;font-size:15px;font-weight:700;margin-bottom:5px;}
.mcard-desc{font-size:12px;color:var(--muted);line-height:1.5;}
.role-select{width:100%;padding:13px 14px;background:var(--s);border:1px solid var(--border);border-radius:10px;color:var(--text);font-size:14px;font-family:'Inter',sans-serif;outline:none;margin-bottom:20px;appearance:none;}
.role-select:focus{border-color:var(--accent);}
.btn-start{width:100%;padding:16px;background:linear-gradient(135deg,var(--accent),#8b5cf6);border:none;border-radius:11px;color:#fff;font-size:16px;font-weight:700;cursor:pointer;font-family:'Syne',sans-serif;transition:all .25s;box-shadow:0 8px 24px rgba(108,99,255,.28);}
.btn-start:hover{transform:translateY(-2px);box-shadow:0 14px 30px rgba(108,99,255,.4);}
.past-section{margin-top:40px;}
.sub-card{background:var(--s);border:1px solid var(--border);border-radius:12px;padding:18px;margin-bottom:10px;display:flex;align-items:center;gap:14px;flex-wrap:wrap;}
.sub-info{flex:1;min-width:180px;}
.sub-role{font-size:15px;font-weight:600;margin-bottom:3px;}
.sub-meta{font-size:12px;color:var(--muted);}
.sub-scores{display:flex;gap:14px;}
.ss{text-align:center;}
.ss-val{font-size:20px;font-weight:700;font-family:'Syne',sans-serif;}
.ss-lbl{font-size:10px;color:var(--muted);text-transform:uppercase;}
.badge{display:inline-block;padding:3px 10px;border-radius:20px;font-size:11px;font-weight:600;}
.badge-green{background:rgba(16,185,129,.12);color:#6ee7b7;}
.badge-red{background:rgba(244,63,94,.12);color:#fda4af;}
.btn-view{padding:8px 16px;background:var(--s2);border:1px solid var(--border);border-radius:7px;color:var(--text);font-size:12px;cursor:pointer;transition:all .2s;}
.btn-view:hover{border-color:var(--accent);color:var(--accent2);}
.empty{text-align:center;padding:36px;color:var(--muted);font-size:14px;background:var(--s);border-radius:12px;border:1px solid var(--border);}
</style>
</head>
<body>
<div class="topbar">
  <div class="brand">ü§ñ RecruitAI</div>
  <div class="topbar-right">
    <span>Hello, <strong id="user-name">‚Ä¶</strong></span>
    <a href="/logout" class="logout-link">Logout</a>
  </div>
</div>

<div class="main">
  <div class="greeting">
    <h1 id="greeting-text">Welcome back!</h1>
    <p>Join a recruiter session with a room code, or start your own practice interview below.</p>
  </div>

  <div class="room-shortcut">
    <div class="rs-field">
      <label>Have a Room Code from Recruiter?</label>
      <input type="text" id="room-input" placeholder="ABCD1234" maxlength="8">
    </div>
    <button class="btn-join-room" onclick="joinByCode()">‚Üí Join Session</button>
  </div>

  <div class="divider">or start your own interview</div>

  <div class="section-title">Choose Interview Mode</div>
  <div class="mode-grid">
    <div class="mcard sel" id="mc-mcq" onclick="selectMode('mcq')">
      <div class="mcard-icon">üìù</div>
      <div class="mcard-title">MCQ Exam</div>
      <div class="mcard-desc">10 role-specific questions. Auto-graded with proctoring active.</div>
    </div>
    <div class="mcard" id="mc-ai_interview" onclick="selectMode('ai_interview')">
      <div class="mcard-icon">ü§ñ</div>
      <div class="mcard-title">AI Interviewer</div>
      <div class="mcard-desc">Alex, our animated AI asks and evaluates open-ended questions via Claude.</div>
    </div>
    <div class="mcard" id="mc-live_recruiter" onclick="selectMode('live_recruiter')">
      <div class="mcard-icon">üé•</div>
      <div class="mcard-title">Live Recruiter</div>
      <div class="mcard-desc">Requires a room code from your recruiter. Full proctoring in background.</div>
    </div>
  </div>

  <select class="role-select" id="role-select">
    <option value="">Select your job role‚Ä¶</option>
  </select>

  <button class="btn-start" onclick="startSelf()">üöÄ Start Interview</button>

  <div class="past-section">
    <div class="section-title">üìã Your Previous Attempts</div>
    <div id="past-list"><div style="color:var(--muted);font-size:14px;padding:20px 0;">Loading‚Ä¶</div></div>
  </div>
</div>

<script>
let selectedMode='mcq', currentUser=null;

async function init() {
  const auth = await fetch('/api/check-auth').then(r=>r.json());
  if (!auth.authenticated) return window.location.href='index.html';
  if (auth.is_admin) return window.location.href='recruiter_dashboard.html';
  currentUser=auth;
  document.getElementById('user-name').textContent=auth.full_name||auth.username;
  document.getElementById('greeting-text').textContent='Welcome, '+(auth.full_name||auth.username).split(' ')[0]+'!';
  await loadRoles();
  await loadPast();
}

async function loadRoles() {
  const data=await fetch('/api/job-roles').then(r=>r.json());
  const sel=document.getElementById('role-select');
  sel.innerHTML='<option value="">Select your job role‚Ä¶</option>'+data.roles.map(r=>`<option value="${r}">${r}</option>`).join('');
}

async function loadPast() {
  const el=document.getElementById('past-list');
  try {
    const data=await fetch('/api/dashboard-stats').then(r=>r.json());
    const mine=(data.recent_submissions||[]).filter(s=>s.username===currentUser.username);
    if (!mine.length){el.innerHTML='<div class="empty">No previous attempts. Start your first interview above!</div>';return;}
    el.innerHTML=mine.map(s=>`
      <div class="sub-card">
        <div class="sub-info">
          <div class="sub-role">${s.job_role||'General'} <span style="font-size:11px;background:rgba(108,99,255,.12);color:var(--accent2);padding:2px 8px;border-radius:10px;margin-left:6px;">${(s.mode||'mcq').replace(/_/g,' ')}</span></div>
          <div class="sub-meta">${s.submitted_at} ¬∑ Attempt #${s.attempt_number||1}</div>
        </div>
        <div class="sub-scores">
          <div class="ss"><div class="ss-val" style="color:${scoreColor(s.credibility_score)}">${s.credibility_score}</div><div class="ss-lbl">Credibility</div></div>
          <div class="ss"><div class="ss-val">${s.interview_score||0}</div><div class="ss-lbl">Interview</div></div>
        </div>
        <span class="badge ${s.passed?'badge-green':'badge-red'}">${s.passed?'PASSED':'FAILED'}</span>
        <button class="btn-view" onclick="window.location.href='results.html?id=${s.id}'">View Report</button>
      </div>`).join('');
  } catch(e){el.innerHTML='<div class="empty">Could not load history.</div>';}
}

function scoreColor(s){return s>=80?'#10b981':s>=60?'#f59e0b':'#f43f5e';}

function selectMode(m){
  selectedMode=m;
  ['mcq','ai_interview','live_recruiter'].forEach(k=>document.getElementById('mc-'+k).classList.toggle('sel',k===m));
}

async function startSelf(){
  const role=document.getElementById('role-select').value;
  if (!role) return alert('Please select a job role');
  if (selectedMode==='live_recruiter') return alert('Live Recruiter mode needs a room code from your recruiter. Please enter it above.');
  const data=await fetch('/api/create-session',{method:'POST',headers:{'Content-Type':'application/json'},
    body:JSON.stringify({job_role:role,mode:selectedMode})}).then(r=>r.json());
  if (!data.success) return alert(data.message||'Error');
  window.location.href=`interview_room.html?room=${data.room_code}`;
}

function joinByCode(){
  const code=document.getElementById('room-input').value.trim().toUpperCase();
  if (code.length<6) return alert('Please enter a valid room code (6-8 characters)');
  window.location.href=`interview_room.html?room=${code}`;
}

init();
</script>
</body>
</html>